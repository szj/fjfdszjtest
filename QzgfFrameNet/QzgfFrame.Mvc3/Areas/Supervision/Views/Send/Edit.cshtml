@model QzgfFrame.Supervision.SendManager.Models.SupervisionSend
@{
    
    ViewBag.Title = "派遣工单编辑页面";
}     
    <script src="@Url.Content("~/Lib/jquery/jquery.autoSearchText.js")" type="text/javascript"></script>
  
    <script type="text/javascript">
        var Validator = null;
        var SysSecond;
        var InterValObj;

        $(function () {
            
            $("#newForm").ligerForm();
            deafultValidate($("#newForm"));
            var options = {
                dataType: 'json',      //期望服务器的的回应的类型。null、"xml"、"script"或者"json"其中之一。
                beforeSubmit: showRequest, //提交成功时执行
                error: showError, //提交错误时执行
                success: showResponse//后台返回后执行
            };
            $('#newForm').ajaxForm(options);
            $.metadata.setType("attr", "validate");
        });

        //提交成功时的数据
        function showRequest(formData, jqForm, options) {

            //验证派遣工单附件是否为空
            if ($("#SendAttachment").val() == "") {
                $.ligerDialog.success("请选择派遣单附件");
                return false;
            }

            $.ligerDialog.waitting("正在保存中...");
            return true;
        }

        //提交出错返回信息
        function showError(data) {
            alert("showError " + data.Message);
        }

        //提交成功后跳转
        function showResponse(data, status) {
            if (data.Type) {
                $.ligerDialog.success(data.Message);
                window.location.href = "/Supervision/Send/Index"; //提交后，页面跳转的地址
            }
            else {
                $.ligerDialog.closeWaitting();
                alert(data.Message);
            }
        }

    </script>
@using (Html.BeginForm("Edit", "Send", FormMethod.Post, new { enctype = "multipart/form-data", name = "newForm", id = "newForm" }))
{
    @Html.ValidationSummary(true, "Account creation was unsuccessful. Please correct the errors and try again.")
    @Html.HiddenFor(m => m.Id)
    <div>
        <table cellpadding="0" border="0" cellspacing="0" class="edittable">
            <tbody>
                <tr>
                    <td class="Right_font">派遣工单主题：<span style="color:Red">*</span></td>
                    <td class="Left_font">
                        @Html.TextBoxFor(m => m.SendTitle, new Dictionary<string, object>() { { "size", 20 }, { "ltype", "text" }, { "validate", "{required:true,minlength:1}" } })
                    </td> 
                </tr> 
                <tr>
                    <td class="Right_font">派遣工单内容：<span style="color:Red">*</span></td>
                    <td class="Left_font">
                        @Html.TextAreaFor(m => m.SendContent, 4, 30, new Dictionary<string, object>() { { "size", 20 }, { "ltype", "text" }, { "validate", "{required:true,minlength:1}" } })
                    </td> 
                </tr> 
                <tr>
                    <td class="Right_font">接单时限：<span style="color:Red">*</span></td>
                    <td class="Left_font">
                        @Html.TextBoxFor(m => m.LimitOrders, new { ltype = "text",validate = "{required:true}",onfocus = "WdatePicker({dateFmt:'yyyy/M/dd'}); "})
                    </td> 
                </tr> 
                <tr>
                    <td class="Right_font">回单时限：<span style="color:Red">*</span></td>
                    <td class="Left_font">
                        @Html.TextBoxFor(m => m.LimitBack, new { ltype = "text", validate = "{required:true}", onfocus = "WdatePicker({dateFmt:'yyyy/M/dd'}); "})
                    </td> 
                </tr> 
                <tr>
                    <td class="Right_font">用户名：<span style="color:Red">*</span></td>
                    <td class="Left_font">
                        @Html.TextBoxFor(m => m.SendPerson, new { maxlength = "20", ltype = "text", validate = "{required:true,minlength:1,maxlength:20,isFullName:true}" })
                    </td> 
                </tr> 
                <tr>
                    <td class="Right_font">用户联系电话：<span style="color:Red">*</span></td>
                    <td class="Left_font">
                        @Html.TextBoxFor(m => m.Phone, new { maxlength = "11", ltype = "text", validate = "{required:true,isMobile:true}" })
                    </td> 
                </tr> 
                <tr>
                    <td class="Right_font">派遣单附件：<span style="color:Red">*</span></td>
                    <td class="Left_font">
                        @if (Model.NewAttachmentName == "" || Model.NewAttachmentName == null)
                        { 
                            <input type="file" id="SendAttachment" name="SendAttachment"/>
                        }
                        else
                        {
                            var fileName = Model.AttachmentName;
                            var delUrl = "DeleteFile/" + Model.Id;
                            var wenz = "(下载文件:右击'另存为')";
                            <a href="@ViewData["fileUrl"]">@fileName</a>;
                            @Html.ActionLink("删除", delUrl, "Send");@wenz;
                            @Html.HiddenFor(m => m.AttachmentName)
                            @Html.HiddenFor(m => m.NewAttachmentName)                                            
                        }
                    </td> 
                </tr> 
                <tr>
                    <td style="width:45%"></td>
                    <td>
                        <input type="submit" value="提 交" name="subsubmit"  id="subsubmit" size="40" class="l-button l-button-submit" style=" float:left"/>
                        <input type="button" value="返 回" onclick="javascript:history.back()" class="l-button l-button-test"style=" float:left"/>
                    </td>
                </tr>
            </tbody>
        </table>
    </div> 
}