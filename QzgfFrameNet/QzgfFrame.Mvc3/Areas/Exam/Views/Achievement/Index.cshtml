    <!--成绩管理-->
    <script type="text/javascript">
        //debugger; 调试时使用
        var gridManager = null;
        var activeDialog = null;
        //考试试卷类型（0,在线考试;1,模拟考试;2,在线练习）
        var ExamType = null;
        //该功能选项菜单id
        var frameId = GetUrlParam('_menuid');

        function f_openWindow(url, title, width, height) {
            var dialogOptions = { width: width, height: height, title: title, url: url, buttons: [
            { text: '保存', onclick: function (item, dialog) {
                dialog.frame.f_save(); //f_save调用的是弹出框调用页的方法
                dialog.close(); //关闭添加窗口
                f_reload(); //刷新数据
                //debugger;
            }
            },
            { text: '关闭', onclick: function (item, dialog) {
                dialog.close();
            }
            }
            ], isResize: true, timeParmName: 'a'
            };
            activeDialog = parent.jQuery.ligerDialog.open(dialogOptions);
        }
        function f_closeWindow(reload) {
            activeDialog && activeDialog.close();
            reload && f_reload();
        }
        function f_btnClick(item) {
            switch (item.id) {
                case "add":
                    f_add();
                    break;
                case "modify":
                    f_modify();
                    break;
                case "delete":
                    f_delete();
                    break;
                case "button":
                    f_button();
                    break;
            }
        }
        function f_button() {
            var rowsdata = gridManager.getCheckedRows();
            if (!rowsdata.length) {
                $.ligerDialog.alert('请先选择行!');
                return;
            }
            var id = rowsdata[0].ID;
            f_openWindow('system/ButtonList.aspx?CurID=' + id, '菜单操作管理', 600, 350);
        }

        //显示添加弹出框
        function f_add() {
            f_openWindow('/Exam/Achievement/Edit/0', '添加成绩管理', 600, 350);
        }

        //显示修改弹出框
        function f_modify() {
            //获取所选中的复选框的值
            var rowsdata = gridManager.getCheckedRows();
            if (rowsdata.length != 1) {
                $.ligerDialog.alert('请选择一行记录!');
                return;
            }
            var id = rowsdata[0].Id;
            f_openWindow('/Exam/Achievement/Edit/' + id, '修改成绩管理', 600, 350);
        }

        //删除成绩管理
        function f_delete() {
            var rowsdata = gridManager.getCheckedRows();
            if (!rowsdata.length) {
                $.ligerDialog.alert('请先选择行!');
                return;
            }

            $.ligerDialog.confirm("是否确认删除?", "提示", function (ok) {
                if (ok) {
                    $.ligerDialog.waitting("正在删除中...");
                    var idStr = "";
                    $(rowsdata).each(function (i, item) {
                        idStr += this.Id;
                        if (i < rowsdata.length - 1) idStr += ",";
                    });
                    $.getJSON('/Exam/Achievement/Delete?id=' + idStr, { Rnd: Math.random() }, function (data) {
                        if (data.Type) {
                            $.ligerDialog.success("删除成功");
                        }
                        else {
                            $.ligerDialog.error("删除失败!<BR>" + data.Message);
                        }
                        $.ligerDialog.closeWaitting();
                        f_reload();
                    });
                } else {
                    return;
                }
            });

        }

        //初始化列表
        $(function () {
            ExamType = $("#ExamType").val();
            f_setToolbar();
            switch (ExamType) {
                case "0":
                    f_setGridSet();
                    break;
                case "1":
                    f_setGridMock();
                    break;
                case "2":
                    f_setGridExercise();
                    break;
            }
        });

        //设置操作按钮
        function f_setToolbar() {
            SetButtons($("#toolbar"), "/system/menu/GetButton?menuid=" + frameId);
        }

        //设置在线考试列表
        function f_setGridSet() {
            gridManager = $("#maingrid").ligerGrid({
                columns: [
                { display: '操作', name: 'Operating', align: 'left', width: 130, minWidth: 60 },
                { display: '考生姓名', name: 'UserName', align: 'left', width: 130, minWidth: 60 },
                { display: '答卷时间', name: 'AnswerStartTime', align: 'left', width: 130, minWidth: 60 },
                { display: '试卷总分', name: 'Fraction', align: 'left', width: 130, minWidth: 60 },
                { display: '考生得分', name: 'Score', align: 'left', width: 130, minWidth: 60 },
                { display: '试卷名称', name: 'TestName', align: 'left', width: 130, minWidth: 60 }
                ], dataAction: 'server',
                url: "/Exam/Achievement/GridPager", sortName: 'id',
                width: '99%', height: '100%', pageSize: 30,
                heightDiff: -9,
                parms: [{ name: "gridsearch", value: ExamType}],
                onError: function (a, b) {
                    debugger
                }
            });
        }

        //设置模拟考试列表
        function f_setGridMock() {
            gridManager = $("#maingrid").ligerGrid({
                columns: [
                { display: '操作', name: 'Operating', align: 'left', width: 130, minWidth: 60 },
                { display: '考生姓名', name: 'UserName', align: 'left', width: 130, minWidth: 60 },
                { display: '答卷时间', name: 'AnswerStartTime', align: 'left', width: 130, minWidth: 60 },
                { display: '试卷总分', name: 'Fraction', align: 'left', width: 130, minWidth: 60 },
                { display: '考生得分', name: 'Score', align: 'left', width: 130, minWidth: 60 },
                { display: '试卷名称', name: 'TestName', align: 'left', width: 130, minWidth: 60 }
                ], dataAction: 'server',
                url: "/Exam/Achievement/GridPager", sortName: 'id',
                width: '99%', height: '100%', pageSize: 30,
                heightDiff: -9,
                parms: [{ name: "gridsearch", value: ExamType}],
                onError: function (a, b) {
                    debugger
                }
            });
        }

        //设置在线练习列表
        function f_setGridExercise() {
            gridManager = $("#maingrid").ligerGrid({
                columns: [
                { display: '操作', name: 'Operating', align: 'left', width: 130, minWidth: 60 },
                { display: '考生姓名', name: 'UserName', align: 'left', width: 130, minWidth: 60 },
                { display: '答卷时间', name: 'AnswerStartTime', align: 'left', width: 130, minWidth: 60 },
                { display: '试卷总分', name: 'Fraction', align: 'left', width: 130, minWidth: 60 },
                { display: '考生得分', name: 'Score', align: 'left', width: 130, minWidth: 60 },
                { display: '试卷名称', name: 'TestName', align: 'left', width: 130, minWidth: 60 }
                ], dataAction: 'server',
                url: "/Exam/Achievement/GridPager", sortName: 'id',
                width: '99%', height: '100%', pageSize: 30,
                heightDiff: -9,
                parms: [{ name: "gridsearch", value: ExamType}],
                onError: function (a, b) {
                    debugger
                }
            });
        }

        function f_reload() {
            gridManager && gridManager.loadData(true);
        }
    </script>
@Html.Hidden("ExamType", @ViewData["ExamType"])
<form id="form1" runat="server">
<div id="topmenu"></div>
<div id="toolbar"></div>
<div id="searchbar"></div>
<div id="maingrid"></div>
</form>
<input type="button" value="导出数据" id="btnExport" onclick="" />